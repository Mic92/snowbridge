# Ethereum Contracts

This directory contains smart contracts utilized by the Polkadot-Ethereum Bridge.

## Development

Requirements:
* Node 14 LTS. See installation [instructions](https://www.digitalocean.com/community/tutorials/how-to-install-node-js-on-ubuntu-20-04#option-3-%E2%80%94-installing-node-using-the-node-version-manager).
* Yarn
* direnv: https://direnv.net/docs/installation.html

Install dependencies with yarn:

```bash
yarn install
```

Create an `.envrc` file using [.envrc.template](.envrc.template) as a template. Note that deploying to ropsten network requires setting the INFURA_PROJECT_ID and ROPSTEN_PRIVATE_KEY environment variables.

Example:

```bash
cp .envrc-example .envrc
direnv allow
```

## Testing

Run tests on the hardhat network:

```bash
yarn test
```

## Deployment

### Local

Example: Run a local hardhat instance with deployments

```
yarn hardhat node
```

### Ropsten, Mainnet

```
yarn hardhat deploy --network ropsten
```

## Tasks

### Upgrade an app

Example: upgrade an app to use a different set of channels

```sh
# Do something first to deploy new channels, then provide addresses below
yarn hardhat upgrade-app \
  --appaddr       0x3f0839385DB9cBEa8E73AdA6fa0CFe07E321F61d \
  --basicinbound  0x0000000000000000000000000000000000000001 \
  --basicoutbound 0x0000000000000000000000000000000000000002 \
  --incinbound    0x0000000000000000000000000000000000000003 \
  --incoutbound   0x0000000000000000000000000000000000000004 \
  --network       localhost # change to ropsten or mainnet accordingly
```

### Upgrade a channel

Example: upgrade a channel to use a different beefy light client
```sh
# Do something first to deploy new channels, then provide addresses below
yarn hardhat upgrade-channel \
  --channeladdr   0x774667629726ec1FaBEbCEc0D9139bD1C8f72a23 \
  --beefyaddr     0x0000000000000000000000000000000000000001 \
  --network       localhost # change to ropsten or mainnet accordingly
```

### Renounce ownership of the CHANNEL_UPGRADE_ROLE

```sh
yarn hardhat renounce \
  --addr 0x3f0839385DB9cBEa8E73AdA6fa0CFe07E321F61d \
  --role CHANNEL_UPGRADE_ROLE \
  --network localhost
```

### Renounce ownership of the BEEFY_UPGRADE_ROLE

```sh
yarn hardhat renounce \
  --addr 0x774667629726ec1FaBEbCEc0D9139bD1C8f72a23 \
  --role BEEFY_UPGRADE_ROLE \
  --network localhost
```

### View the address of deployed contract's

```sh
yarn hardhat  contractAddressList \
  --network localhost # change to ropsten or mainnet accordingly
```

## Autogenerated Documentation

Solidity documentation can be autogenerated using the [solidity-docgen](https://github.com/OpenZeppelin/solidity-docgen) library. It will generate markdown files from the contracts directory and output them to the docs directory.

```bash
# The library is only compatible with npx
npx solidity-docgen
```
